<kt-portlet>
  <kt-portlet-header [sticky]="true" [title]="'Créer une demande de chargement'" [class]="'card-head-lg'" [viewLoading$]="loading$">
    <ng-container ktPortletTools>
      <button type="button" (click)="onSubmit()" class="btn btn-success btn-sm mr-2">Sauvgarder</button>

      <div ngbDropdown class="d-inline-block">
        <button class="btn btn-sm" id="dropdownBasic1" ngbDropdownToggle><i class="icon-2x text-dark-50 flaticon-more-v2"></i></button>
        <div ngbDropdownMenu aria-labelledby="dropdownBasic1">
          <button class="dropdown-item">Sauvgarder et quitter</button>
        </div>
      </div>
    </ng-container>
  </kt-portlet-header>
  <kt-portlet-body>
    <div class="example-preview">
      <!-- *************** FORM ******************* -->

      <div>
        <form class="form" [formGroup]="validationForm">
          <div class="row">
            <div class="form-group col-3">
              <label class="form-group">Role:</label>
              <select (change)="onSelectRole($event.target.value)" name="role_code" id="role_code" formControlName="role_code" class="form-control form-control-sm form-control-solid">
                <option value=""></option>
                <option *ngFor="let elem of roles" [value]="elem.role_code">{{ elem.role_code }} {{ elem.role_name }}</option>
              </select>
            </div>

            <div class="form-group col-2">
              <label class="form-group">Imprimer:</label>
              <div class="input-group input-group-sm">
                <span class="switch switch-icon">
                  <label>
                    <input type="checkbox" class="form-control form-control-sm form-control-solid" formControlName="print" />
                    <span></span>
                  </label>
                </span>
              </div>
            </div>
          </div>

          <br />
        </form>
      </div>

      <br />
      <span>Liste pages de produits</span>
      <br /><br />
    </div>

    <div class="row" *ngFor="let items of loadRequestData">
      <!--begin::Header-->
      <div class="col-12 card-header border-0 py-5 bg-success text-white">
        <h3 class="card-title align-items-start flex-column">
          <span class="card-label font-weight-bolder text-dark">Page Produit : {{ items.product_page_code }} </span>
        </h3>
      </div>

      <div class="col-12 row">
        <div class="col-12 card card-custom">
          <!--end::Header-->
          <!--begin::Body-->
          <div class="col-12 card-body py-0">
            <!--begin::Table-->
            <div class="col-12 table-responsive">
              <table class="col-12 table table-head-custom table-vertical-center" id="kt_advance_table_widget_1">
                <thead class="col-12">
                  <tr class="text-left">
                    <th class="pr-0" style="width: 150px">Code produit</th>
                    <th class="pr-0" style="width: 350px">Designation</th>
                    <th style="min-width: 200px">QTE stockée</th>
                    <th style="min-width: 150px">QTE demandée</th>
                    <th style="min-width: 150px">QTE validée</th>
                    <th style="min-width: 150px">Prix</th>
                    <!-- <th class="pr-0 text-right" style="min-width: 150px">action</th> -->
                  </tr>
                </thead>
                <tbody class="col-12" *ngFor="let productPage of items.productPageDetails">
                  <tr>
                    <!-- <td class="pl-0">
                      <label class="checkbox checkbox-lg checkbox-inline">
                        <input type="checkbox" ng-checked="product.qt_request==0" />
                        <span></span>
                      </label>
                    </td> -->
                    <td class="pr-0">
                      <span class="text-dark-75 font-weight-bolder text-hover-primary mb-1 font-size-lg">{{ productPage.item.pt_part }}</span>
                    </td>
                    <td class="pr-0">
                      <span class="text-dark-75 font-weight-bolder text-hover-primary mb-1 font-size-lg">{{ productPage.item.pt_desc1 }}</span>
                    </td>
                    <td class="pl-0" class="row" style="display: flex; align-items: center; justify-content: center">
                      <span class="text-dark-75 font-weight-bolder d-block font-size-lg">{{ getSum(productPage.item.locationDetails) }}</span>
                      <button type="button" class="btn btn-outline-secondary mr-2" placement="right" ngbPopover="{{ returnData(productPage.item.locationDetails) }}" popoverTitle="Stock par lot">...</button>
                    </td>
                    <td>
                      <span class="text-dark-75 font-weight-bolder d-block font-size-lg">0</span>
                    </td>
                    <td>
                      <input type="number" max="50" (change)="onInputChanged(items.product_page_code, productPage.item.pt_part, $event.target.value)" class="text-dark-75 font-weight-bolder text-hover-primary mb-1 font-size-lg" value="{{ productPage.item.pt_ord_min }}" />
                    </td>
                    <td>
                      <span class="text-dark-75 font-weight-bolder d-block font-size-lg">{{ productPage.item.priceLists.length > 0 ? productPage.item.priceLists["0"].salesprice + " DA" : productPage.item.pt_price + " DA" }}</span>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <!--end::Table-->
          </div>
          <!--end::Body-->
        </div>
      </div>
      <br /><br />
    </div>
  </kt-portlet-body>
</kt-portlet>
